<html>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<style type="text/css">
<!--
body { background: #FFF }
table{border:1px solid gray; font-size:14pt;}
tr td {padding: 5px;  border:0px; border-bottom: thin solid gray; text-align:center;}
.yellowThing {background: #FE7;}
.whiteThing {background: #FFF;}
.grayThing {background: #DDD;}
.smallfont {font-size:12pt;}
//-->
</style>
<script src="/js/jquery-2.1.4.min.js"></script>
<!--<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>-->
<script language='javascript'>
function DoAjax(requestUrl, sentData, sHandler, eHandler, pageNotFoundHandler){
        $.ajax({
            type: 'GET',    
            url: requestUrl,
            cache: false,       
            data: sentData, 
            success: sHandler,   
            error: eHandler,      
            statusCode: {    
              404: pageNotFoundHandler
            }
        });
    };
function qSymInfo()
{
    /*
    makeMainTable([{"symbol":"A50","keyval":{"BPV":"1.000000","DESC":"A50%20Index"}},{"symbol":"CIF","keyval":{}},{"symbol":"ES","keyval":{}}])
    return;
    */
    url='/cgi-bin/qsyminfo.py'
    DoAjax(url, {symbol : "ALL"},
        function(data, textStatus, jqXHR){
		makeMainTable(data);
        }); 
}
function doupdate(idx, sym){
 desc=document.getElementById('desc'+idx).value
 bpv=1*document.getElementById('bpv'+idx).value
 mko=1*document.getElementById('mko'+idx).value
 mkc=1*document.getElementById('mkc'+idx).value
 ssec=(document.getElementById('ssec'+idx).checked==true?1:0)
 //alert('ready to update: '+sym+', desc:'+desc+', bpv:'+bpv)
 location.href='/cgi-bin/usymbol.py?sym='+encodeURI(sym)+'&desc='+desc+'&bpv='+bpv+'&mko='+mko+'&mkc='+mkc+
               '&ssec='+ssec;
}
function doimport1min(idx, sym){
 location.href='/i1min.html?sym='+encodeURI(sym);
}
function strQDay(datetime){
    var dd = datetime.getDate();
    var mm = datetime.getMonth()+1; //January is 0!
    var yyyy = datetime.getFullYear();
    return yyyy+"-"+mm+"-"+dd
}
function doq1min(idx, sym){
    var begday = new Date();
    begday.setDate(begday.getDate() - 3);
    var endday = new Date(); 
    endday.setDate(endday.getDate() + 3);
    beg = strQDay(begday) 
    end = strQDay(endday)
    location.href='/cgi-bin/q1min.py?symbol='+encodeURI(sym)+'&BEG='+beg+"&END="+end;
}
function doq1sec(idx, sym){
    var begday = new Date();
    begday.setDate(begday.getDate() - 3);
    var endday = new Date();
    endday.setDate(endday.getDate() + 3);
    beg = strQDay(begday)
    end = strQDay(endday)
    location.href='/cgi-bin/q1sec.py?symbol='+encodeURI(sym)+'&BEG='+beg+"&END="+end;
}
function dosummery(idx, sym){
    location.href='/cgi-bin/qsummery.py?symbol='+encodeURI(sym)
}
function makeMainTable(allSymInfo)
{
    //ex:
    //allsymbol = [{"symbol": "WTX", "keyval": {"MKO": "84500", "DESC": "Taifex", "MKC": "134500", "BPV": "200"}}]
    len = allSymInfo.length
    strTable="<table>"
    strTable+="<tr class='grayThing smallfont'><td rowspan=2>Symbol</td><td colspan=6>Symbol Settings</td><td rowspan=2>Query</td><td rowspan=2>Import</td></tr>"
    strTable+="<tr class='grayThing smallfont'><td>Desc.</td><td>BigPoint<br>Value</td><td>MarketOpen<br>(HHmmSS)</td><td>MarketClose<br>(HHmmSS)</td><td>Store<br>Sec</td><td>Action</td></tr>"
    
    for (i=0;i<len;++i)
    {
        symbol=allSymInfo[i]['symbol']
        bpv=''
        desc=''
        mko=''
        mkc=''
        storesec_checked=''
        if ('keyval' in allSymInfo[i])
        {
            if ('BPV' in allSymInfo[i]['keyval']) bpv = allSymInfo[i]['keyval']['BPV'];
            if ('DESC' in allSymInfo[i]['keyval']) desc = allSymInfo[i]['keyval']['DESC'];
            if ('MKO' in allSymInfo[i]['keyval']) mko = allSymInfo[i]['keyval']['MKO'];
            if ('MKC' in allSymInfo[i]['keyval']) mkc = allSymInfo[i]['keyval']['MKC'];
            if ('SSEC' in allSymInfo[i]['keyval'] && 1 == allSymInfo[i]['keyval']['SSEC'])
                storesec_checked = 'checked';
            try{desc=decodeURI(desc)}catch(e){}
        }
        strTable+="<tr onmouseover=\"this.className='yellowThing';\" onmouseout=\"this.className='whiteThing';\">"
        strTable+="<td>"+symbol+"</td><td><input type='text' id='desc"+i+"' value='"+desc+"'></td>"
        strTable+="<td><input type='text' id='bpv"+i+"' value='"+bpv+"' size='5'></td>"
        strTable+="<td><input type='text' id='mko"+i+"' value='"+mko+"' size='10'></td>"
        strTable+="<td><input type='text' id='mkc"+i+"' value='"+mkc+"' size='10'></td>"
        strTable+="<td><input type='checkbox' id='ssec"+i+"' "+storesec_checked+"/></td>"
        strTable+="<td>"
        strTable+="<button type='button' value='' onclick=\"doupdate("+i+", '"+symbol+"')\">Update</button>&nbsp;"
        strTable+="</td><td>"
        strTable+="<button type='button' value='' onclick=\"dosummery("+i+", '"+symbol+"')\">Summery</button>&nbsp;"
        strTable+="<button type='button' value='' onclick=\"doq1min("+i+", '"+symbol+"')\">1Min</button>&nbsp;"
        strTable+="<button type='button' value='' onclick=\"doq1sec("+i+", '"+symbol+"')\">1Sec</button>&nbsp;"
        strTable+="</td><td>"
        strTable+="<button type='button' value='' onclick=\"doimport1min("+i+", '"+symbol+"')\">1Min</button></td>"
        strTable+="</tr>"
    }
    strTable+="</table>"
    document.getElementById('mainDiv').innerHTML = strTable;
}
</script>
<body onload='qSymInfo()'>
<div id='mainDiv'></div>
</body></html>
